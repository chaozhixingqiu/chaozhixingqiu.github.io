# 怕什么真理无穷，让Python和R共舞

随着开源技术的迅速取代了传统的闭源技术，Python和R语言在数据科学中变得越来越受欢迎。

之前我写了两篇文章，一篇推荐R，一篇推荐Python。

两篇文章的推荐，是针对不同的应用场景与需求的。换句话说，选择哪个主要还是依赖你的背景以及你的目标：

* 如果你没有任何编程经验，建议你先学R；如果你想学数据可视化，我认为R的ggplot2包是最好的工具；如果你想专门从事数据分析和数据挖掘，R表现更优秀。
* 如果你有编程基础，建议你学Python，如果你想成为机器学习专家，Python的scikit-learn库可以好好研究一下；如果你想开发软件系统，Python更合适。

RStudio的首席数据科学家Hadley Wickham在twitter上的一个回复很有意思：

![](/media/15936153422771.jpg)

是啊，R和Python并不是你死我活的关系，完全可以相互协作嘛。本篇文章，讲一讲R和Python如何协作。

那么，让我们开始吧！

## 让Python与R共舞

在庞大的科学和数学计算群体中，还存在各种不同的子社群，它们之间虽然有些重叠，但总体来说，他们对Python与R的关系还是差别还是挺大的。

以下是一些依赖 Python 和 R 语言的领域：
* Deep Learning 深度学习
* Machine Learning 机器学习
* Advanced Analytics 高级分析
* Predictive Analytics 预测分析
* Statistics 统计学
* Exploration and Data Analysis 数据探索和分析
* Academic Scientific Research 学术与科学研究
* 以及…数不胜数的各类科学计算领域研究项目

几十年来，不同领域的研究人员和开发人员一直在争论，进行数据科学和数据分析，Python和R语言哪种才是更好的选择。

我们就不能好好相处吗？为啥我们不能同时利用这两个语言呢？

世上本没有最好的软件或程序，也鲜有人能把单一语言挖掘运用到极致。把两种语言结合在一起，我们会有以下的收获：

1. 不再担心要放弃已经学了的知识。很多人早先学了R，现在完全不用又舍不得，所以对于想要学以致用的人来说，如果能把R和Python相结合，就更好不过了。
2. 充分利用两者的优势。比如，R去做它最专业的统计和画图。而像连接数据库、文本处理、文件操作等这些“脏活”，交给咱最熟悉的、做这些脏活最棒的Python。
3. 干活更高效。其实吧，与其讨论哪种语言更高效，不如讨论如何让我们的工作更高效。比如，你学Python的，但是你在研究的领域前人论文里用的都是R，你是调整下R代码，还是Python重写？

![](/media/15936159410661.jpg)

如果你已经打定主意这么干，那接下来的问题很清楚了，R和Python如何一起工作？

拍拍脑袋，想到可能有下面几种办法：

## 第一个模式：R和Python，互通有无

R和Python，是两个独立的语言，他们两个的通信，应该有两个方案（这两个方案主要是语言交互的原理，但一般来说，实际以这两种应用的场景比较少）。

1. R和Python只共享文件，Python把源数据处理干净，生成格式化的文件放在预定的目录下，做个定时器让R去读文件，最终输出统计结果和图表。
2. 让Python直接调用R的函数，R是开源项目，肯定会有一些第三方库实现Python与R互通。当然了，肯定也存在让R直接调用Python的库。

第一种做法，理解起来简单，但实际落地操作麻烦，并且限制太大，只能够交换文件，Python不能对R进行精确的控制。本文，咱讲一下，第2种方法。

列下列表，可以自查。

* Python封装的R语言包，比如rpy2、pyRserve、Rpython等
* R封装的Python语言包，比如rPython、PythonInR、reticulate、rJython、SnakeCharmR以及XRPython等

因为我是以Python为主，R为辅的，所以我讲下在Python里面调用R的方法。

这里要用的Python包，叫做rpy2。rpy2的安装，在此不多讲了。基于它，可以实现使用python读取R的对象、调用R的方法以及Python与R数据结构转换等。

访问R的对象在R的命令行中，我们直接输入对象名来访问R的内置对象，如pi、letters：

![在R控制台中访问R对象](/media/15939154843101.jpg)


而使用r实例，python访问R对象也很简单，而且方法很多：

![在python中访问R对象](/media/15939155963916.jpg)

代码解读：
* rpy2.robjects是rpy2对R的一个高级封装，该模块里包含了一个r对象和一系列的R数据结构。使用rpy2的大多数情况，只需要跟这个模块打交道即可。
* rpy2.robjects.r，它叫做r实例，本质上是在Python中的嵌入式R进程，把r当作从python走向R的通道来看就可以了。通过r实例，我们可以读取R的内置变量、调用R的函数、甚至，直接把它当作R的解析器来用。
* 在上图这段代码中，用了三种方式来访问R对象，把r实例当作字典，把r实例当作方法，把r实例当作一个类对象（真是神喻呀～）。
* 在实际中，使用哪一种方式要因习惯而异，我喜欢的方法是使用第三种，把r实例当作自己人，直接使用”.”来访问R对象。但这种方法有一个缺陷，就是不能访问带名字空间的R对象或函数，而其他两种方式是可以的。

在rpy2的调用中，还有两个最佳实践需要注意：

第一个最佳实践：自定义函数

加载自定义函数在实际应用中，使用R语言来编写自己的函数同样是不可避免的，在R控制台中，可以使用source(‘script_path’)的方法来加载自定义R脚本。

而在Python中使用自定义R脚本中的函数也同样方便：使用r.source(‘script_path’)，即可把自定义函数加载到全局环境中，再使用r.自定义方法名就可以实现调用。

在此不再详述，同学们自己动手玩一下。

第二个最佳实践：数据类型转换

Python要与R打交道，除了访问R对象和调用R函数，还有就是要学会如何转换常见的数据类型。

向量(Vector)是R的一个最重要的也是最常用的数据类型，可以理解为一个二维数据，对应Python的list。在R控制台中，声明一个变量：“x <- 1”，X会被声明成一个向量，而其第一个值是1。R常常用c()函数来创建一个由多个值组成的向量，例如c(1,2,3,4)。

rpy2提供了几个类，供我们把Python的list转换成R的Vector。分别是robjects.IntVector,robjects.Boolvector,robjects.StringVector,robjects.FloatVector。

以IntVector为例，将Python的list转换成R的Vector：
robjects.IntVector([1,2,3,4,5])，毕！

关于rpy2更多的知识、场景、最佳实践，请移步rpy2官方文档。

## 第二个模式：Jupyter，一统江湖

上面那个有点复杂是不是，复杂就对了。那是很程序层面的用法。再次强调我在推荐R时说的：

**数据科学家使用编程语言的方式与软件开发者不一样。对于数据科学新手来说，程序(programs)应该是脚本(scripts)，而不应该是函数(function)。**

通过函数库，实现相互的调用，总归是不够简洁的。接下来，大杀器，Jupyter Notebooks和Anaconda登场了。

注：Jupyter Notebooks 让用户可以在浏览器里编写运行 Python 或 R 代码；Anaconda 提供了一个简单方便的 Python 或 R 语言的包管理工具。

从此，你拥有了一套即开即用的，适合提供数据分析与报告的编程环境。曾经横亘在技术任务和编程语言之间的环境壁垒被打破了。Python终于有了一套不依赖于某个平台的数据分析环境。

你可以直接在 Jupyter Notebook 里把它们混着用。比如下面这样：

![](/media/15939170359543.jpg)


上面这样处理完之后，我们就可以把 pandas 的 dataframe 对象传给 ggplot2，它将会通过 rpy2 插件自动转换成一个 R 语言的 Dataframe。（需要传入 -i df 开关参数）

![](/media/15939170824772.jpg)

## 关于选择倾向

在有那么几种情况下，你确实可以把两种语言混在一起用。比如：

* 你所在的公司或者机构允许你这么玩
* 你能方便快捷地搭建和维护这样的工作环境
* 你不需要迁移代码到别的系统上去
* 你并不打算拿这一团混沌的代码去祸害其他小朋友

但也有很多时候，你的选择，其实没你想象的那么自由。还有一些其它因素可能影响你的决定，比如：

* 如果你的大多数同事或朋友都在使用某种语言，那么你可以也去学那门语言，因为遇到问题可随时咨询他们。
* 如果你想去的公司都在使用某种语言，你也可以学那门语言，到时候就不需任何相关培训了。
* 如果你的老师上的一门课，或是你的某个工作，要求你使用R语言，那你也没得选了。

数据科学云服务 Kaggle 上有人写了一个项目，用来预测一个分析师更爱用 R 还是 Python。根据观测到的数据，他提出了几个有趣的结论：

* 如果你接下来的一年内考虑迁移到 Linux，你更有可能是 Python 用户
* 如果你学的是统计学，那你更可能用 R，而如果你学的是计算机科学，那基本Python没跑了
* 如果你比较年轻（比如18-24岁），你更可能用 Python
* 如果你参加代码大赛，你更可能用 Python
* 如果你接下来想要弄个机器人什么的，你更可能用 Python
* 如果你接下来想要学 SQL，你更可能用 R
* 如果你习惯用微软的 Office，你更可能是 R 语言的用户
* 如果你想要搞个树莓派，你更可能用 Python
* 如果你是个全日制学生，你更可能用 Python
* 如果你用敏捷方法，你更可能用 Python
* 如果你对人工智能表示担心，而不是兴奋，那你很有可能用 R 语言

我个人来说，我并没有特别信仰哪种语言(我现在用python多，也主要是写程序用)。我从来就不是一个工具优先论者，我始终主张**人不能被工具绑架，人要熟练的驾驭各种工具，具体问题具体分析**。

## 关于学习理念

“R和Python都学”这话也被很多人说过。但是，单单只说这句这话对小白来说，有点不太负责。因为对于小白来说，同时学两个，是困难的。

在此，我提出两种执行层面的学习模式，供参考。

一个一个学，深入浅出模式：
* 学习方法：这种方法，偏结构主义。比如学Python，你就学python数据结构，基本语法，常用三方库等等。一步一步的学习，然后应用。
* 学习路径：先根据需求学一种。再根据需要判断是否学另一种。
* 学习结果：要么掌握了一门，要么掌握了两门。
* 注意要点：整体上学习语言体系，还要落到实践中印证。
* BTW：如果之前没有学过R，可以先学Python然后决定是不是学R，如果学了R，学Python的时候会更快上手。

两个一起学，从浅入深模式：
* 学习方法：这种方法，偏实用主义。即在每一个实际问题上，同时看两种语言的解决方法————比如，《超智·统计学》系列是讲统计学的，我会在整个学习过程中同时使用两种代码。如分别用Python和R实现方差分析。
* 学习路径：结合案例，同时学习两种。
* 学习结果：结合案例，同时掌握了两门。
* 注意要点：实践中学习语言，要注意学习语言基础体系。
* BTW：同时学习，掌握两者的差异是必要的。如果你需要处理一些很重要的东西，倘若不经过认真分析，随便乱选一个工具，可不是什么明智的事情。

## 写在最后

最后，我必须要强调的，你不用担心选择错误。**“怕什么真理无穷,进一寸有一寸的欢喜”**。不论你选择什么，你都可以放心大胆的去学习、尝试，提升自己。保持开放的心态，拥抱多样性吧。